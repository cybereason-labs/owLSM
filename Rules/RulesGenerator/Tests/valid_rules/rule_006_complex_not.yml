# Rule 006: Specific rule that matches chmod 777 /tmp/1
# MATCHES: chmod 777 /tmp/1, chmod 755 /tmp/1, chmod 644 /tmp/1
# NO MATCH: chmod 666 /tmp/1 (excluded), chmod 555 /tmp/1 (excluded)
# NO MATCH: chmod 777 /tmp/2 (no /1), chmod 777 /opt/1 (no /tmp)
id: 6
description: "Specific rule matching chmod to /tmp with /1"
action: "BLOCK_KILL_PROCESS_KILL_PARENT"
events:
    - CHMOD
detection:
    # CommandLine must contain ALL of these
    cmdRequired:
        process.cmd|contains|all:
            - "/tmp"
            - "/1"
    
    # Path must start with /usr
    pathStart:
        process.file.path|startswith: "/usr"
    
    # Path must contain ALL of these
    pathRequired:
        process.file.path|contains|all:
            - "bin"
            - "chmod"
    
    # Filename exact match
    filenameExact:
        process.file.filename: "chmod"
    
    # Exclude these modes (if ANY matches, exclude)
    excludedModes:
        - process.cmd|contains: "666"
        - process.cmd|contains: "555"

    # Final condition: all required AND not excluded
    condition: cmdRequired and pathStart and pathRequired and filenameExact and not excludedModes
