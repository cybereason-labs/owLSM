id: 30
description: "Detect suspicious file operations on sensitive paths"
action: "BLOCK_EVENT"
events:
    - CHMOD
    - CHOWN
    - READ
    - WRITE
    - UNLINK
    - FILE_CREATE
detection:
    selection_sensitive_paths:
        target.file.path|startswith:
            - "/etc/passwd"
            - "/etc/shadow"
            - "/etc/sudoers"
    selection_non_root:
        process.euid|gt: 0
    condition: selection_sensitive_paths and selection_non_root

