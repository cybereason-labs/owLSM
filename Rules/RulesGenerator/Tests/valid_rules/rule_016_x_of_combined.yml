# Rule 016: Test combining "X of" with complex conditions
# Mix of "2 of target*" with other conditions
id: 16
description: "Complex detection with multiple thresholds"
action: "BLOCK_EVENT"
events:
    - CHMOD
detection:
    target_bin:
        process.file.path|contains: "bin"
    
    target_cmd:
        process.cmd|contains: "chmod"
    
    target_mode:
        chmod.requested_mode|gte: 755
    
    filter_root:
        process.euid: 0
    
    filter_system:
        process.file.path|startswith: "/usr/"
    
    # At least 2 of 3 target_* selections must match,
    # AND at most 1 filter can be true (not both filters)
    condition: 2 of target* and not (all of filter*)

